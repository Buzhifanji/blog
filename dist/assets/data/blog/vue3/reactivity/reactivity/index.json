{"hash":"4b019abb8f897e4bb396b259705083d0ab6099bd","data":{"blogPost":{"title":"Test","content":"<h1 id=\"逐行分析-vue32-源码之-reactive-笔记\"><a href=\"#%E9%80%90%E8%A1%8C%E5%88%86%E6%9E%90-vue32-%E6%BA%90%E7%A0%81%E4%B9%8B-reactive-%E7%AC%94%E8%AE%B0\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>逐行分析 vue3.2 源码之 reactive 笔记</h1>\n<p>首先我们阅读vue的版本是3.2.19。</p>\n<p>代码地址：<a href=\"https://github.com/vuejs/vue-next/blob/master/packages/reactivity/src/reactive.ts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/vuejs/vue-next/blob/master/packages/reactivity/src/reactive.ts</a></p>\n<p>官方文档地址：<a href=\"https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive</a></p>\n<p>在分析之前，我们得提出问题，vue3是如何实现 reactive？理解了 reactive 也就是理解了 vue3的响应式原理。</p>\n<h2 id=\"reactive-入口函数\"><a href=\"#reactive-%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>reactive 入口函数</h2>\n<p>我们从 reative 入口函数走起</p>\n<pre><code class=\"language-typescript\">export function reactive(target: object) {\n  // if trying to observe a readonly proxy, return the readonly version.\n  // 如果 target 是 只读 的proxy,则返回 target自身\n  if (target &#x26;&#x26; (target as Target)[ReactiveFlags.IS_READONLY]) {\n    return target\n  }\n  return createReactiveObject(\n    target,\n    false,\n    mutableHandlers,\n    mutableCollectionHandlers,\n    reactiveMap\n  )\n}\n</code></pre>\n<h2 id=\"理解-target-四个属性\"><a href=\"#%E7%90%86%E8%A7%A3-target-%E5%9B%9B%E4%B8%AA%E5%B1%9E%E6%80%A7\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>理解 Target 四个属性</h2>\n<pre><code class=\"language-typescript\">// 字符串 常量枚举\nexport const enum ReactiveFlags {\n  SKIP = '__v_skip',\n  IS_REACTIVE = '__v_isReactive',\n  IS_READONLY = '__v_isReadonly',\n  RAW = '__v_raw'\n}\n\n// 接口 Target key 是 ReactiveFlags中定义的枚举\nexport interface Target {\n  [ReactiveFlags.SKIP]?: boolean\n  [ReactiveFlags.IS_REACTIVE]?: boolean\n  [ReactiveFlags.IS_READONLY]?: boolean\n  [ReactiveFlags.RAW]?: any\n}\n</code></pre>\n<ul>\n<li>__v_skip</li>\n</ul>\n<p>通过 测试用例 我们知道，当target 对象上有 __v_skip 属性为true时，此时的target就不是 响应式的。</p>\n<p>** <em>此属性在阅读vnode的时候会被用上</em></p>\n<pre><code class=\"language-js\">  test('should not observe objects with __v_skip', () => {\n    const original = {\n      foo: 1,\n      __v_skip: true\n    }\n    const observed = reactive(original)\n    // 判断 是否为 reactive\n    expect(isReactive(observed)).toBe(false)\n  })\n</code></pre>\n<ul>\n<li>\n<p>__v_isReactive</p>\n<p>当target上有 __v_isReactive 属性并且为true时，代表此target已经是响应式</p>\n</li>\n<li>\n<p>__v_isReadonly</p>\n<p>当target上有 __v_isReadonly属性并且为true时，代表此target是只读，不能进行修改</p>\n</li>\n<li>\n<p>__v_raw</p>\n<p>当target上有 __v_raw属性并且为true时，代表此target已经是响应式，并且是 ref类型</p>\n</li>\n</ul>\n<p>vue3中有两种响应式，一种是通过 reative,另一种是 ref。</p>\n<p>一图总结</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 805 400' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-034b034aaa8cb04835b6bc8e9cbb9280'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-034b034aaa8cb04835b6bc8e9cbb9280)' width='805' height='400' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAgCAYAAACinX6EAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAF40lEQVRo3tWZaU/jMBCG%2b///BR%2bREDdfkJZLLIe0gLjvq5SbttxXKbPzWJ2s6yZpWmARlkZJHGfsef3OeOzk5AvK%2b/u7u1YqFbm/v5fHx0d5enqSh4cHubu7c3J7exvd%2b0J72vEN8vLyUqfzs0vuK4yvVqvufmtrS9bX1%2bXi4kLOzs7k%2bPhY8vm87OzsRLK3tyeHh4euvlAouOvR0ZGcnp669rT5sQBsb2%2b7WfQLrAjL8/OzE2Y%2bLCcnJ5G%2bHwnAzc1N9I6ZnZ%2bfl4WFBVlaWpLx8XEZHh6WwcFB6e/vl66uLscACjoQWPCjALDBGwD4upW3tzfn48zq5uamTE5OOgNxkXK57NzEGAOQyI8CwAbtxwBjAHVZ/djaAhiMsO%2bSvrd%2baw9fD4Dfod07CRiwu7vrov9HysHBQR14df0F0gDGVzMg7CjsHJrjBsViUa6uruTy8lLOz89dhEegPEIdwj31uAiC8cSLBv0xRsdd/w8DlKZvGsH9TvFnljQMxzCecQWugIChGIh/c2UZJEDybHWILZ3oInZE/fvuUssTqm3mC7l2DPcpXx4bk5tfv6SkEb2owQyfxejX19fMegHGEp64ghudKBBHCkRZQblfXJQHXU2up6bkcmjIXUsjI1JRPREIGYHItevzVl51Zs40mdn988fNLoErEbBALFZAe1stzN9D36YAEm33FIAzFQx%2b1%2b%2bqmkE%2bKYsq19ef4wKJQc5TTELDTOd1VkreWt8MsLgYgh6jeNx3DX3r/aUan1dWXJNWewlUHIBpQTOXNrCkWcA3oXq5RjlbfuICUxZWoc8HwP82DYg3nYQrZd3KyopMqRvEZZnNxpBLo2roh5bL%2b9nde4uGh4ZAffYLBMI0xoR9mPsQa2ZmZqSvr0/m5uaioMo4k4T39n0ubcC829/fd4bje35e347hSRQnHUZ/EuuSAjEF5hh4MMD2FXHCJBKj2GDxHLkAPkjSgiLWXoSlp6enRzo7O13ezjNLFe%2byZGdZjceN2BP4QTApz4jTxQaKsbUyFuyoAwCjQBJ0oJQJM04dyOL7iLHCFLQz81ZszacPdF57UTxL%2bhsCkJZu%2bzqZwDoAqEhbh8PiK2iHAQwU0P2Nkm19YWO7DDD2YAuAMs6NjY2o3q6xAOAfzADCek6gQ0qlkmMHqSwCG3wKtcoAWIXxfE%2bqjHsxSFyQQdM3QDRbRtMAYLzoJTgSXyw3SQQAgziOmp6eljHN7Do6OqS7u1t6e3tdHGAPPzAw4PbtlsbaJqfVqA%2bIFrRGR0dlSDM5%2biWCLy8vO4BWV1cTo38WAMwVLPCF3ycygNlFIYHJBEZQx8B5RnlWF0iaRaIwS5/VGZj0ATsAGOZlBYAJ9A9R4nIJe0dhAhoY0ErunsUFkgaNgYAK2JwHWhywM0C/D9whSZ8PAIC1UhpWAQaCvwMCs2FiFLKrsQR/9QFolm7yDd%2bGgY/30Bd97BzjMkQGa1limOYae9bW1qKdYzMBaGKOZY1RHgAIdJaWQZnQrpU8gA4ZpHUaLlf%2b0Xeob1E3PRMTE6n92HE7QPnH67747/34lfvIcXPd%2bb8OgoE81M716exVDWN2CaT7CjCdxzEnNN7%2bJyDEndnZWTlVmj/rwO2/QdRHC64bN/ZcFho3ozhBLa%2bB5VgHWVCKFZQhyLHeH8AafQdFoTsRPm6z4%2buDjZaCI7Y0FpDaAYllpgBsy1w7Y/%2bUI7EDHWzt2Fd0mv81YHaCGcKF/DODuKTHonpDGzZhwY6Pth/5e/QpAEBvFpgnMjnNH4ojI1LWJKTMSc3kpJTUh291y2ptkwDw12mobadOFQW1/Pu3XGguUlHaU1dVHby3tt8LgDGgdi5Q1fVcCDQIxuq1WsvzWYOzABD%2bC6hy8hOkzmEa/60A4KcsZUVNYDghKmrwcqLP7qoA8J5/Bc32%2b5YWm58jhVoMOKqtQrZiEX8MrG8DgMjO3x1AcGL3fp0KbSwPSMvvMch2n5FoH068Ovr9iPGf8meonY7TjP%2bIvna%2b/QuaBT4Qbyp%2bCQAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"805\" alt=\"Alternative text\" data-srcset=\"/blog/assets/static/Target.82a2fbd.ac2e5c824d6605d996a105a15552b038.png 480w, /blog/assets/static/Target.7135616.ac2e5c824d6605d996a105a15552b038.png 805w\" data-sizes=\"(max-width: 805px) 100vw, 805px\" data-src=\"/blog/assets/static/Target.7135616.ac2e5c824d6605d996a105a15552b038.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/blog/assets/static/Target.7135616.ac2e5c824d6605d996a105a15552b038.png\" width=\"805\" alt=\"Alternative text\"></noscript></p>\n"}},"context":{}}