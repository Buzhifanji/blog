"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createBaseApp = void 0;
const pluginApi_1 = require("../pluginApi");
const appInit_1 = require("./appInit");
const appPrepare_1 = require("./appPrepare");
const appUse_1 = require("./appUse");
const resolveAppDir_1 = require("./resolveAppDir");
const resolveAppEnv_1 = require("./resolveAppEnv");
const resolveAppOptions_1 = require("./resolveAppOptions");
const resolveAppSiteData_1 = require("./resolveAppSiteData");
const resolveAppVersion_1 = require("./resolveAppVersion");
const resolveAppWriteTemp_1 = require("./resolveAppWriteTemp");
const resolvePluginsFromConfig_1 = require("./resolvePluginsFromConfig");
const resolveThemeInfo_1 = require("./resolveThemeInfo");
/**
 * Create vuepress app
 */
const createBaseApp = (config, isBuild = false) => {
    const options = (0, resolveAppOptions_1.resolveAppOptions)(config);
    const dir = (0, resolveAppDir_1.resolveAppDir)(options);
    const env = (0, resolveAppEnv_1.resolveAppEnv)(options, isBuild);
    const pluginApi = (0, pluginApi_1.createPluginApi)();
    const siteData = (0, resolveAppSiteData_1.resolveAppSiteData)(options);
    const version = (0, resolveAppVersion_1.resolveAppVersion)();
    const writeTemp = (0, resolveAppWriteTemp_1.resolveAppWriteTemp)(dir);
    const app = {
        options,
        siteData,
        version,
        // utils
        dir,
        env,
        pluginApi,
        writeTemp,
        // methods
        use: (...args) => (0, appUse_1.appUse)(app, ...args),
        init: () => (0, appInit_1.appInit)(app),
        prepare: () => (0, appPrepare_1.appPrepare)(app),
    };
    // resolve theme info and set app layouts
    const themeInfo = (0, resolveThemeInfo_1.resolveThemeInfo)(app, options.theme, options.themeConfig);
    app.layouts = themeInfo.layouts;
    // resolve plugins
    const plugins = (0, resolvePluginsFromConfig_1.resolvePluginsFromConfig)(app, options.plugins);
    [...themeInfo.plugins, ...plugins].forEach((plugin) => app.use(plugin));
    return app;
};
exports.createBaseApp = createBaseApp;
