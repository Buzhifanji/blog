---
title: JavaScript垃圾回收
date: 2023-02-22 13:57:26
category:
  - fontend
tag:
  - JS
  - GC
---

> 垃圾回收用于描述**查找**和**删除**那些不再被其他对象引用 (en-US)的对象 处理过程。
> 换句话说，垃圾回收是删除任何其他对象未使用的对象的过程。
> 垃圾收集通常缩写为 "**GC**"，是JavaScript中使用的内存管理系统的基本组成部分。

js中的内存管理是自动的,每当我们去创建一个对象的时候会自动去分配内存空间,后面通过判断确认其是否是垃圾。

需要注意的是，当垃圾回收工作的时候,它会**阻塞js代码的执行**。

## js中的垃圾有哪些?

判断js对象是否为垃圾以下两个方面进行判断：

- **对象不再被引用**
- **对象不能从根上访问到时**

不再被引用，说明使用价值，自然成了垃圾。

从跟上能访问到的对象称为**可达对象**，不能访问的是**不可达对象**，这里的`跟`可以理解为全局作用域。

```javascript
function func(){
    name = 'li'
    return `${name} is a good boy`
}
func() // 函数调用完成之后 name不再被使用,并且外部无法访问。name成为了垃圾
```

## GC算法

GC是一种机制,查找垃圾,释放,回收,分配空间时所遵循的规则叫GC算法。

### 引用计数

记录变量对象引用的次数，当增加一次引用是，记录值加一；减少一次引用时，记录值减一。当引用次数为 0 ，就成为了垃圾。

核心思想：*设置引用数,判断当前引用数是否为 0*

**优点：** 
- 发现垃圾立即回收,减少程序卡顿时间

**缺点：**
- 需要时刻监听引用数的变化，而且数值需要计算，所以**时间开销大**
- 对于循环引用的对象的引用数不会为0，所以**无法回收循环引用的对象**

### 标记清除

对所有对象进行两次遍历，第一次遍历将所有**可达对象**标记为活动对象，无法被标记。第二次遍历清楚没有被标记的对象。回收后的空间会放到空闲链表中.完成一次垃圾回收之后清除所有标记

**优点：** 
- 可以回收收循环引用的对象（解决了引用计数的一个缺点）

**缺点：**
- 容易产生**空间碎片化**.由于垃圾对象在地址上是不连续的,所以回收后的空间也不是连续的,造成后续在使用的时候就要匹配内存大小.
- 不能立即回收垃圾对象,因为它要在最后才能清除

### 标记整理

可以看做是标记清除的增强版,只不过在清除阶段会先执行整理内存空间,移动对象的位置让地址产生连续.

**优点：** 
- 解决了空间碎片化的问题

**缺点：**
- 不能立即回收垃圾对象

### 分代回收
