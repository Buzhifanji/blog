---
title: 计算机系统漫游
date: 2022-07-05 12:22:26
permalink: /pages/8a9936/
categories:
  - 深入理解计算机系统
tags:
  - 读书笔记
  - 计算机系统
---

这是深入理解计算机系统的第一章，这一章是对计算机系统知识的概括，这其中会引入一些专业术语，但并不会深入解释这些术语。书本就是我们学习知识的引入路，先让读者窥探整片森林，以防迷失在某一知识细节中。所以这一章很重要，应该好好读一读。

另外关于这本书籍，B站有 UP 主专门讲解视频 [B站up 九曲阑干: 【合集】CSAPP-深入理解计算机系统​](https://www.bilibili.com/video/BV1cD4y1D7uR/?spm_id_from=333.788&vd_source=db32dbb771562f27b0d0eac9992d81bb)

这一章以打印“hello world”为例，讲述程序在计算机系统的生命周期，并介绍计算机系统的主要概念和主题。

```cpp
#include <stdio.h>

int main() {
  printf("hello, world!\n");
  return 0;
}
```

## 1.1 信息就是位 + 上下文

**位**是计算机最小单位，其值由 0 和 1 组成，又称为**比特**。8 位被组织成一组，称为**字节**。

程序最终执行的时候，最终都会转为二进制，而转换的依据就是**上下文**。

在大部分操作系统中使用 [ASCII](https://habaijian.com/)来表示文本字符，以 ASCII 作为上下文，那么 ‘#’ 字符对应的字节整数值为35，‘i’ 字符对应的字节整数值为105........

## 1.2 程序的翻译

执行 hello.c 的命令

```liunx
gcc -o hello hello.c
```

这条命令通过*编译器驱动程序*，把源文件转化成*可执行目标文件*，这个过程一共分为四个阶段。


![程序翻译四阶段](https://cdn.jsdelivr.net/gh/Buzhifanji/imgs-store/blog/20220705135948.png)

- 预处理

  读取系统头文件的内容，并插入到程序文本，得到另外一个程序。

  例如 读取 hello.c 中的第一行 ```#include <stdio.h>```头文件的内容，插入到程序文本，得到一个 hello.i 文件
- 编译器
  
  把文本文件的内容翻译成汇编语言

  把 hello.i 翻译成 hello.s

  ```
  main: 
    2 subq $8, 
    %rsp 3 movl $.LCO, 
    %edi 4 call puts 5 movl $0, 
    %eax 6 addq $8, 
    %rsp 7 ret
  ```
- 汇编
  
  把汇编语言翻译成机器指令，把这些指令会被打包成*可重定位目标程序（relocatable object program）*的格式，得到 hello.o，这是一个二进制文件。
- 链接器
  
  合并程序内部调用的函数，得到一个可执行目标文件的内容。

  在 hello 程序内部调用了 printf 函数，这个函数是 C 编译器提供的标准库函数。它会被预编译成 printf.o 文件。链接要做的事情，就是把 hello.o 和 printf.o 合并成 hello *可执行文件*。

## 1.3 了解编译系统如何工作的益处

- 优化程序性能
- 理解链接时出现的错误
- 避免安全漏洞

## 1.4 程序的执行

如何运行 hello 可执行程序，以 Unix 系统为例子：

1. 打开 shell 程序
2. 在 shell 中输入相应可执行程序的文件名

```shell
linux> 
  ./hello 
  hello, world 
linux>
```
shell 程序是一个命令解释器，它输出一个提示符，等待输入命令行，然后执行这个命令
如果该命令的第一个单词不是内置的 shell 命令，那么 shell 就会假设这是一个可执行文件的名字，它将加载并运行这个文件。

### 1.4.1 系统的硬件组成

![一个典型系统的硬件组成](https://cdn.jsdelivr.net/gh/Buzhifanji/imgs-store/blog/20220705145808.png)
