---
title: array-last
date: 2022-03-25 09:19:42
permalink: /pages/261551/
categories:
  - npm
  - 数组
tags:
  - npm
  - 数组
---

:::theorem array-last
获取数组的最后一个元素或最后 n 个元素
::: right
来自 [github](https://github.com/jonschlinkert/array-last)
:::

## 用例

获取最后一个元素

```javascript
var last = require('array-last');

last(['a', 'b', 'c', 'd', 'e', 'f']);
//=> 'f'

last(['a', 'b', 'c', 'd', 'e', 'f'], 1);
//=> 'f'
```
获取最后 n 个元素

```javascript
var last = require('array-last');

last(['a', 'b', 'c', 'd', 'e', 'f'], 3);
//=> ['d', 'e', 'f']
```

array-last 接受两个参数，第一个参数是数组，第二个参数是可选，表示获取的个数。返回一个数组。

## 源码

array-last 依赖包：[is-number](../60.数学/5.is-number.md)

我们来看看代码实现：

```javascript
var isNumber = require('is-number');

module.exports = function last(arr, n) {
  // 判断第一个参数是否为数组
  if (!Array.isArray(arr)) {
    throw new Error('expected the first argument to be an array');
  }

  // 如果数组为空，直接返回null
  var len = arr.length;
  if (len === 0) {
    return null;
  }

  // 处理第二个可选参数
  // 如果number，则取 +n，否则取1
  n = isNumber(n) ? +n : 1;
  if (n === 1) {
    // 当n为1，表示只取最后一个元素
    return arr[len - 1];
  }

  // 作者这里巧妙利用n来获取数组最后n个元素
  // 先是 声明一个长度为n的数组，此时数组里每个元素为undefined
  // 然后 利用 while循环，每次循环n就减少一次，然后把arr索引n位置的元素复制给res索引n，直到n为结束循环。

  // 此处换成for循环也是一样可以实现的。
  var res = new Array(n);
  while (n--) {
    res[n] = arr[--len];
  }
  return res;
};
```

## 测试

array-last 采用测试库是[ mocha ](https://github.com/mochajs/mocha)

测试异常

```javascript
  it('should throw an error if invalid arguments are passed', function() {
    assert.throws(function() {
      last();
    }, /expected/i);

    assert.throws(function() {
      last('foo');
    }, /expected/i);

    assert.throws(function() {
      last({ foo: 'bar' });
    }, /expected/i);
  });
```
测试取最后一个

```javascript
  it('should return the last element in the array:', function() {
    assert.strictEqual(last(['a', 'b', 'c', 'd', 'e', 'f']), 'f');
    assert.strictEqual(last(['a', 'b', 'c', 'd', 'e', 'f'], 1), 'f');
  });
```

测试取最后n个

```javascript
  it('should the last n elements of the array:', function() {
    assert.deepEqual(last(['a', 'b', 'c', 'd', 'e', 'f'], 3), ['d', 'e', 'f']);
  });
```
测试空数组

```javascript
  it('should return null if the array has no elements', function() {
    assert.strictEqual(last([]), null);
    assert.strictEqual(last([], 3), null);
  });
```
测试很全面，测试了各种情况。

## 总结

array-last 的用途：获取数组的最后一个元素或最后n个元素。

array-last 的实现一共分为四步：

1. 处理第一个必填参数的异常情况
2. 处理空数组情况
3. 处理可选参数n，当isNumber为true的时候，取+n,否则取1
4. 处理返回值，当n为1,则取最后一个元素作为数组内容返回，否则遍历，返回n个元素

先处理异常，整理参数，然后才整理处理内容。

测试考虑到了各种异常。