---
title: is-sort
date: 2022-03-24 10:35:39
permalink: /pages/52796e/
categories:
  - npm
  - 数组
tags:
  - npm包
  - Array
---

:::theorem is-sort
检查数组是否被排序
::: right
来自 [github](https://github.com/dcousens/is-sorted)
:::

## 用例

基本用法

```javascript
var sorted = require('is-sorted')

console.log(sorted([1, 2, 3]))
// => true

console.log(sorted([3, 1, 2]))
// => false
```

自定义排序

```javascript
var sorted = require('is-sorted')
// supports custom comparators
console.log(sorted([3, 2, 1], function (a, b) { return b - a }))
// => true
```
is-sort 接受两个参数，第一个参数是数组，第二个参数是可选，自定义排序函数，最终返回 Boolean 值：true、false。

## 源码

我们来看看代码实现：

```javascript
// 默认排序操作函数
function defaultComparator (a, b) {
  return a - b
}

module.exports = function checksort (array, comparator) {
  // 判断第一个参数是否为数组
  if (!Array.isArray(array)) throw new TypeError('Expected Array, got ' + (typeof array))
  // 处理排序函数
  comparator = comparator || defaultComparator

  // 遍历数组，进行比对
  for (var i = 1, length = array.length; i < length; ++i) {
    if (comparator(array[i - 1], array[i]) > 0) return false
  }

  return true
}
```

## 测试

is-sort 采用测试库是[ tape ](https://github.com/substack/tape)

is-sort 一个共写了两个测试：正常、异常。异常很简单，传入错误参数。

正常测试示例，作者并不是一个个去书写，而是通过**配置**。

具体做法是：写一份 json 配置文件，然后读取这份配置，读取完之后遍历，执行测试。

json数据格式：数组包裹对象。

```json
[
  {
    "array": [1, 5, 2, 3, 4],
    "expected": false
  },
  {
    "array": [5, 4, 3, 1, 2],
    "comparator": "descending",
    "expected": false
  }
]
```
测试代码：

```js
var sorted = require('../')
var fixtures = require('./fixtures')
var tape = require('tape')
var comparators = {
  descending: function (a, b) { return b - a }
}
// 遍历 json配置项
fixtures.forEach(function (f) {
  // 执行测试
  tape('returns ' + f.expected + ' for ' + f.array, function (t) {
    t.plan(1)
    // 执行sort函数
    var actual = sorted(f.array, comparators[f.comparator])
    // 比对 执行结果与配置内容
    t.equal(actual, f.expected)
  })
})

// 测试 异常
tape('throws on non-Array inputs', function (t) {
  t.plan(1)
  t.throws(function () {
    sorted('foobar')
  }, /Expected Array, got string/)
})
```

## 总结

is-sort 用途检查数组是否有序的。

is-sort 函数的实现一共分为三步

1. 处理第一个必填参数的异常情况
2. 处理第二个可选参数
3. 遍历数组，执行排序函数。如果执行结果存在大于0的情况，就返回 false，否则就返回 true

套路：先异常，再可选，最后函数内容本身。

从 is-sort 的测试可以学到，如果测试同一个函数，可以通过配置 json，而不是重复写一样的测试用例

最后留个疑问：如果换成 typescript 实现，会带来什么变化？