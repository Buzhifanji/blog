---
title: dedupe
date: 2022-03-28 10:40:32
permalink: /pages/e42af2/
categories:
  - npm
  - 数组
tags:
  - npm
  - 数组
---

:::theorem dedupe
数组去重
::: right
来自 [github](https://github.com/seriousManual/dedupe)
:::

## 用例

基本用法

```javascript
var dedupe = require('dedupe')

var a = [1, 2, 2, 3]
var b = dedupe(a)
console.log(b)

//result: [1, 2, 3]
```

去重对象

```javascript
var dedupe = require('dedupe')

var aa = [{a: 2}, {a: 1}, {a: 1}, {a: 1}]
var bb = dedupe(aa)
console.log(bb)

//result: [{a: 2}, {a: 1}]
```

自定义对比函数

```javascript
var dedupe = require('dedupe')

var aaa = [{a: 2, b: 1}, {a: 1, b: 2}, {a: 1, b: 3}, {a: 1, b: 4}]
var bbb = dedupe(aaa, value => value.a)
console.log(bbb)

//result: [{a: 2, b: 1}, {a: 1,b: 2}]
```

dedupe 接受两个参数，第一个必填数组参数，第二个选填函数参数。

## 源码

```javascript
function dedupe (client, hasher) {
  // 处理选填参数：默认JSON.stringify，系列化之后，就可以比对数组，对象。
  hasher = hasher || JSON.stringify

  const clone = []
  const lookup = {} 

  for (let i = 0; i < client.length; i++) {
      let elem = client[i]
      let hashed = hasher(elem)

      // 如果 lookup 没有，则push到clone里，并往lookup添加这个记录
      if (!lookup[hashed]) {
          clone.push(elem)
          lookup[hashed] = true
      }
  }

  return clone
}
```

## 测试

dedupe 采用测试库是[ mocha ](https://github.com/mochajs/mocha)，[ chai ](https://www.chaijs.com/)

数字去重测试一共有三个测试用例，一个对象去重，一个自定义去重函数，最后两个日期去重。[点击查看测试详情](https://github.com/seriousManual/dedupe/blob/master/test.js)

## 总结

dedupe 的用途：数组里删除掉相同的元素。

实现：遍历数组，默认通过JSON.stringify序列化每个元素，并且缓存起来，每次都会去缓存里查找，找不到就会把元素推入到结果中。

实现思路简单，测试用例全面。

如果只是简单去重基本数据类型，用Set数据结构，就很容易实现。但如果要去重对象，Set就不行了。因为即使对象里的内容是一致的，但是引用地址不一样，Set就会当作是两个不一样的元素来处理。